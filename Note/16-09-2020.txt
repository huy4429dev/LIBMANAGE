Hôm nay mình sẽ xây dựng chức năng login 

- chúng ta sẽ tự dựng chức năng authenicate
xác thực người dùng 

- k dùng sẵn module identity của asp.net 

tất nhiên thì đi làm đa phần thì sẽ dùng 

cái này r custom lại . Nhưng mình sẽ làm 

1 hệ thống basic để mn hiểu hơn 

I. DB

1. users 

- Id
- username
- password
- email 
- address 
- avatar 
- phone
- gender
- BirthDate  
- status ( có thể để tạm dừng tài khoản)
- createdTime (thời gian tạo tk)

2. Roles  - vai trò 

- Id 
- RoleName

3. userRoles - bảng trung gian 

- userId 
- roleId 

4. Claims - quyền

- Id 
- name 

5. roleClaims  - bảng trung gian 

- userId
- RoleId 

--> hiện tại là : 1 user có thể nhiều role - ngược lại 
				  1 role có thể có nhiều quyền - ngược lại 
				  
				  -> ok chốt 
				  
				  code nào 

- model 
- view
- controller [route] 

phân tích 

-> làm chức năng login trang quản trị 

--> page login [view] form đăng nhập 

--> tài khoản ? viết code tạo tài khoản admin 

--> sau đó admin bắt đầu tạo các tài khoản để nhân viên đăng nhập vào trang quản trị 

--> logic vậy thôi 

--> bây h mình sẽ tạo model 

entity framework --> nó sẽ map các model tương ứng với các bảng trong DB 
				 --> quản lý DB bằng code 
				 --> thay đổi DB --> tạo migration --> sau đó migrate để update database
				 --> migration hiêu là quản lý phiên bản Db [vì nó lưu lịch sử code khi tạo DB]
				 
				 --> nó có thằng dbContext truy cập vào model đê thêm sưa xóa truy vấn data từ DB 
				 
				 --> dùng LINQ để truy vấn dữ liệu thay vì viết SQL 
				 
				 --> chắc chi có thế / ôn lại tí lý thuyết 

				// thong thả nhé mn 
				
				// mình làm k hiểu nhắn tin nhé cái nào hiểu r thì thô

				      // tôn trọng quyền 3D giới tính 
					  
					  bình thường thì true false thôi 
					  
					  nhưng h 3D nhiều quá



tạo khóa ngoại và quan hệ relationship 

// users --> 

có thuộc tính userRoles là 

1 collection 

nên 

--> ví dụ thằng admin 

mình dễ dàng truy cập lấy ra 

các cái role của nó 

users.usersRoles.select(r => r.Role.name )



KIỂU VẬY 




đã xong 

khá cồng kềnh

-- với quan hệ nhiều 

nhiều mình phải 

dùng thêm cái code để đặt quan hệ 

k cần nhớ nhé cop về paste vào 

- AdminController 

để make users 

// mình sẽ chú thích code 

để tất cả đọc hieeur 

// sau nay sẽ bỏ đi


HttpGet đây là 1 http request 

get 


// nó có thể gửi lên qua url 

hoặc là form 


-> url : https://localhost:5001/admin/make-admin


vì ở controller này mình khai báo cái route đó 


nên nó sẽ tạo ra 1 object từ controller này 

và gọi hàm makeUser 

// nay cố gắng làm xong cái login


// ở đây 

mình gán luốn role admin 

đầu tiên là tạo role 

sau đó gán vào 


vì useer có nhiều role 

mà trong khai báo userRoles 

nên ở đó phải để new List<>

oke


với password thì phải mã hóa đúng k 
mình chạy debug 
xem null ơ đâu



crGkvukZ7YBcU8aGM2cpbQ==


cồng kềnh 

thì thế này thường password 

nhập vào 123456 ---> trên db 









